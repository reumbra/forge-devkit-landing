---
import Container from "@shared/ui/Container.astro";
import SectionLabel from "@shared/ui/SectionLabel.astro";
import Card from "@shared/ui/Card.astro";
import Button from "@shared/ui/Button.astro";
import Badge from "@shared/ui/Badge.astro";
import { pricing } from "@shared/config/pricing";

/**
 * Primary/large Button variants auto-append " ->".
 * Strip trailing arrow from CTA text for primary buttons to avoid duplication.
 */
function ctaLabel(tier: (typeof pricing.tiers)[number]): string {
	if (tier.isPopular) {
		return tier.cta.replace(/\s*\u2192\s*$/, "");
	}
	return tier.cta;
}
---

<section id="pricing" class="py-24 md:py-32">
	<Container>
		{/* Section label + headline */}
		<div class="mb-16 text-center">
			<SectionLabel text={pricing.sectionLabel} />
			<h2
				class="mt-4 font-sans text-[36px] font-bold leading-[1.1] tracking-[-0.02em] text-text md:text-[48px]"
			>
				{pricing.headline}
			</h2>
		</div>

		{/* 3 tier cards */}
		<div class="grid gap-6 md:grid-cols-3">
			{
				pricing.tiers.map((tier) => (
					<Card
						hover={true}
						class:list={[
							"flex flex-col",
							tier.isPopular && "border-[rgba(118,73,196,0.2)] shadow-[0_0_60px_rgba(118,73,196,0.1)]",
						]}
					>
						{/* Popular badge */}
						{tier.isPopular && tier.badge && (
							<div class="mb-4">
								<Badge text={`\u2605 ${tier.badge}`} size="md" />
							</div>
						)}

						{/* Tier name */}
						<p class="font-mono text-[14px] font-medium uppercase tracking-[0.15em] text-secondary">
							{tier.name}
						</p>

						{/* Price */}
						<div class="mt-4 flex items-baseline gap-1">
							<span class="font-sans text-[48px] font-black leading-[1] text-text">
								${tier.price}
							</span>
							<span class="font-sans text-[16px] text-text-muted">
								{tier.period}
							</span>
						</div>

						{/* Description */}
						<p class="mt-3 font-sans text-[14px] leading-[1.5] text-text-muted">
							{tier.description}
						</p>

						{/* Features list */}
						<ul class="mt-6 flex-1 space-y-3">
							{tier.features.map((feature) => (
								<li class="flex items-start gap-2.5 font-sans text-[15px] leading-[1.5] text-text-secondary">
									<span class="mt-0.5 shrink-0 text-secondary">&#10003;</span>
									{feature}
								</li>
							))}
						</ul>

						{/* CTA button */}
						<div class="mt-8">
							<Button
								variant={tier.isPopular ? "primary" : "ghost"}
								href={tier.checkoutUrl}
								class="w-full"
							>
								{ctaLabel(tier)}
							</Button>
						</div>
					</Card>
				))
			}
		</div>

		{/* Trust signals */}
		<div class="mt-12 text-center">
			{
				pricing.trustSignals.map((signal, i) => (
					<p class:list={[
						"font-sans text-[14px] leading-[1.8] text-text-muted",
						i > 0 && "mt-1",
					]}>
						{signal}
					</p>
				))
			}
		</div>
	</Container>
</section>
